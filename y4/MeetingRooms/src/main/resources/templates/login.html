<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/">HOME</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
</nav>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <h1 class="text-center">Login - Meeting Room Management</h1>
            <br>
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" id="login-link" data-toggle="tab" href="#login">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="register-link" data-toggle="tab" href="#register">Register</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="login">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" class="form-control" id="login-email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <input type="password" class="form-control" id="login-password" name="password">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="button" class="btn btn-danger" id="google-login">
                            <img src="https://img.icons8.com/color/48/000000/google-logo.png" width="20" height="20">
                            Login with Google
                        </button>
                    </form>
                </div>
                <div class="tab-pane" id="register">
                    <form id="register-form">
                        <div class="form-group">
                            <label for="register-email">Email</label>
                            <input type="email" class="form-control" id="register-email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="register-password">Password</label>
                            <input type="password" class="form-control" id="register-password" name="password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirm Password</label>
                            <input type="password" class="form-control" id="confirm-password" name="password">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-firestore.js"></script>
<script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAKibeEtAD3sC4Y_fAzFOiB5qUMsCVgtmc",
        authDomain: "traffic-signs-124b4.firebaseapp.com",
        projectId: "traffic-signs-124b4",
        storageBucket: "traffic-signs-124b4.appspot.com",
        messagingSenderId: "466988563720",
        appId: "1:466988563720:web:fc28400ae3692a8ca340bd",
        measurementId: "G-SWVKW0Q7GT"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();

    function handleSignIn(result) {
        const user = result.user;
        console.log("User UID: ", user.uid)
        // const userRef = firestore.collection('users').doc(user.uid);
        // userRef.set({
        //   credits: 0
        // }, { merge: true })
        // .then(() => {
        //   console.log("Document successfully written!");
        //   alert("OK");
        // })
        // .catch((error) => {
        //   console.error("Error writing document: ", error);
        //   alert(error.message);
        // });

        // Redirect to main app page
        window.location.href = '/';
    }

    document.getElementById('login-form').addEventListener('submit', (event) => {
        event.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        auth.signInWithEmailAndPassword(email, password)
            .then((result) => {
                handleSignIn(result)
            })
            .catch((error) => {
                console.error(error);
                alert(error.message);
            });
    });

    document.getElementById('register-form').addEventListener('submit', (event) => {
        event.preventDefault();
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        auth.createUserWithEmailAndPassword(email, password)
            .then((result) => {
                handleSignIn(result)
            })
            .catch((error) => {
                console.error(error);
                alert(error.message);
            });
    });

    document.getElementById('google-login').addEventListener('click', () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
            .then((result) => {
                handleSignIn(result)
            })
            .catch((error) => {
                console.error(error);
                alert(error.message);
            });
    });


</script>
</body>
<script>
    // Register / Login tab switches
    registerlink = document.getElementById("register-link")
    loginlink = document.getElementById("login-link")
    registerlink.addEventListener("click", function(){
        console.log("Register");
        registerlink.classList.add("active");
        loginlink.classList.remove("active");
        document.getElementById("register").classList.add("active");
        document.getElementById("login").classList.remove("active");
    });

    loginlink.addEventListener("click", function(){
        console.log("Login");
        registerlink.classList.remove("active");
        loginlink.classList.add("active");
        document.getElementById("register").classList.remove("active");
        document.getElementById("login").classList.add("active");
    });

</script>
</html>
